<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        
        <template id="pricing" inherit_id="website_quote.pricing" customize_show="True" name="Monthly total" >
            <xpath expr="//h1[@class='page-header']" position="replace">
                <h1 class="page-header">Fixed Costs</h1>
            </xpath>
            <xpath expr="//table[@class='table wq-table']/thead/tr/th[3]" position="attributes">
                <attribute name="class">hidden</attribute>
            </xpath>
            <xpath expr="//table[@class='table wq-table']/thead/tr/th[1]" position="before">
                <th/>
            </xpath>
            <xpath expr="//t[@t-as='line']/tr/td[3]" position="attributes">
                <attribute name="class">hidden</attribute>
            </xpath>
            <xpath expr="//t[@t-as='line']/tr/td[1]" position="before">
                <td>
                    <img class="img img-responsive center-block" t-att-src="'/website/image/product.product/%s/image/50x50' %line.product_id.id" style="max-height: 50px;"/>
                </td>
            </xpath>
            <xpath expr="//t[@t-if='page_index == page_size - 1']/tr[2]" position="attributes">
                <attribute name="class">hidden</attribute>
            </xpath>
            <xpath expr="//t[@t-if='page_index == page_size - 1']/tr[3]" position="attributes">
                <attribute name="class">hidden</attribute>
            </xpath>
            <xpath expr="//t[@t-if='page_index == page_size - 1']/tr[1]/td[5]" position="replace">
                <td class="text-right"><strong>Total:</strong></td>
            </xpath>
            <xpath expr="//t[@t-foreach='quotation.order_lines_layouted()']" position="after">
                <h1 class="page-header">Monthly Costs</h1>
                <table class="table">
                    <thead>
                        <tr>
                            <th/>
                            <th>Products</th>
                            <th>Quantity</th>
                            <th class="text-right">Unit Price</th>
                            <th class="text-right">Total Price</th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-set="monthly_line_ids" t-value="quotation.project_id.recurring_invoice_line_ids"/>
                        <t t-foreach="monthly_line_ids" t-as="line">
                            <tr>
                                <td>
                                    <img class="img img-responsive center-block" t-att-src="'/website/image/product.product/%s/image/50x50' %line.product_id.id" style="max-height: 50px;"/>
                                </td>
                                <td>
                                    <span t-field="line.product_id.name"/>
                                </td>
                                <td>
                                    <div>
                                        <span t-field="line.quantity"/>
                                        <span t-field="line.uom_id.name"/>
                                    </div>
                                </td>
                                <td class="text-right">
                                    <div t-field="line.price_unit" t-options='{"widget": "monetary", "display_currency": quotation.pricelist_id.currency_id}'/>
                                </td>
                                <td class="text-right" groups="sale.group_show_price_subtotal">
                                    <span t-field="line.price_subtotal" t-options='{"widget": "monetary", "display_currency": quotation.pricelist_id.currency_id}'/>
                                </td>
                            </tr>
                        </t>
                        <tr>
                            <td/><td/><td/>
                            <td class="text-right"><strong>Total:</strong></td>
                            <td class="text-right" style="padding-bottom: 32px">
                                <t t-set="monthly_total" t-value="sum(line.price_subtotal for line in monthly_line_ids)"/>
                                <strong data-id="monthly_total" t-esc="monthly_total" t-options='{"widget": "monetary", "display_currency": quotation.pricelist_id.currency_id}'/>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </xpath>
        </template>
        <template id="so_quotation" inherit_id="website_quote.so_quotation" customize_show="True" name="Monthly total (box)" >
            <xpath expr="//div[@t-if=&quot;order_valid and quotation.state in ['draft', 'sent']&quot;]" position="after">
                <div id="sidebar-total" class="" style="padding: 0px 20px;" t-ignore="True">
                    <p class="text-center">Fixed Total: <strong><span data-id="total_amount" t-field="quotation.amount_untaxed" t-options='{"widget": "monetary","display_currency": quotation.pricelist_id.currency_id}'/></strong></p>
                    <p class="text-center">(Excl. tax)</p>
                </div>
                <div id="sidebar-total-monthly" class="" style="padding: 0px 20px;" t-ignore="True">
                    <p class="text-center">Monthly Total: <strong><span data-id="monthly_total_amount" t-esc="sum(quotation.project_id.recurring_invoice_line_ids.mapped('price_subtotal'))" t-options='{"widget": "monetary","display_currency": quotation.pricelist_id.currency_id}'/></strong></p>
                    <p class="text-center">(Excl. tax)</p>
                </div>
            </xpath>
        </template>
    </data>
</odoo>
